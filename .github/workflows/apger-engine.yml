- name: Deploy to repository root
        run: |
          APG_ROOT="$(pwd)/apg_root"

          # Extract contents to repository root
          cp "$APG_ROOT/metadata.json" .
          cp "$APG_ROOT/md5sums" .

          if [ -d "$APG_ROOT/data" ]; then
            cp -r "$APG_ROOT/data"/* .
          fi

          if [ -d "$APG_ROOT/home" ]; then
            cp -r "$APG_ROOT/home" .
          fi

          if [ -d "$APG_ROOT/scripts" ]; then
            cp -r "$APG_ROOT/scripts" .
          fi

          # Commit and push
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Deploy package ${{ env.PACKAGE_NAME }} v${{ env.PACKAGE_VERSION }}" || echo "No changes to commit"
          
          # Try normal push twice, then force
          if git push origin main; then
            echo "Push successful on first attempt"
          elif git push origin main; then
            echo "Push successful on second attempt"
          else
            echo "Normal push failed twice, forcing push"
            git push --force origin main
          fi
